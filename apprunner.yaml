version: 1.0
runtime: nodejs16
build:
  commands:
    pre-build:
      - echo "Installing dependencies..."
      - cd backend
      - npm ci
    build:
      - echo "Building application..."
      - npm run build
    post-build:
      - echo "Build completed successfully!"
      
run:
  runtime-version: 16
  command: cd backend && npm start
  network:
    port: 5000
    env: APP_PORT
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "5000"
    - name: FRONTEND_URL
      value: "https://stmg7szp76.eu-west-1.awsapprunner.com"
    - name: DATABASE_URL
      value: "postgresql://mainadmin:rmsn2025whatsapp@whatsappbot-db.chwsoysw4ghw.eu-central-1.rds.amazonaws.com:5432/whatsappbot"
    - name: DB_SSL
      value: "true"
    - name: OPENAI_API_KEY
      value: "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"
    - name: OPENAI_MODEL
      value: "gpt-4o-mini"
    - name: OPENAI_CONTENT_FILTER
      value: "true"
    - name: OPENAI_ALLOW_EXPLICIT
      value: "false"
    - name: JWT_SECRET
      value: "leyla-suite-prod-2025-jwt-secret-a8f3d9c2e1b7f4a6d8e2c5b9a1f3e7d4"
    - name: WHATSAPP_TYPING_DELAY
      value: "true"

